<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grupos | Alfaiataria</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="main-header">
        <div class="logo">Alfaiataria</div>
        <nav>
            <ul class="nav-links">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="produtos.html">Produtos</a></li>
                <li><a href="usuarios.html">Usuários</a></li>
                <li><a href="grupos.html" class="active">Grupos</a></li>
                <li id="menu-vendas"><a href="vendas.html">Vendas</a></li>
                <li><a href="index.html" class="logout">Sair</a></li>
            </ul>
        </nav>
    </header>

    <main class="content fade-in">
        <h1>Grupos de Usuários</h1>

        <ul class="group-list" id="lista-grupos">
            <li>Carregando grupos...</li>
        </ul>
    </main>

<script  src="main.js">
// ===============================================
// CARREGAR GRUPOS
// ===============================================
async function carregarGrupos() {
    const lista = document.getElementById("lista-grupos");
    lista.innerHTML = "<li>Carregando grupos...</li>";

    try {
        const response = await fetch("http://127.0.0.1:8000/api/grupos");
        const data = await response.json();

        const grupos = data.grupos;

        lista.innerHTML = "";

        if (!Array.isArray(grupos) || grupos.length === 0) {
            lista.innerHTML = "<li>Nenhum grupo encontrado.</li>";
            return;
        }

        grupos.forEach(g => {
            const li = document.createElement("li");
            li.textContent = `${g.nome} — ID: ${g.id} — ${g.descricao}`;
            lista.appendChild(li);
        });

    } catch (error) {
        console.error("Erro ao carregar grupos:", error);
        lista.innerHTML = "<li>Erro ao conectar ao servidor.</li>";
    }
}


// ===============================================
// VERIFICAR LOGIN E PERMISSÃO
// ===============================================
function verificarPermissoes() {
    const usuario = JSON.parse(localStorage.getItem("usuario") || "null");

    if (!usuario) {
        alert("Você precisa estar logado!");
        window.location.href = "index.html";
        return;
    }

    if (usuario.grupo_id !== 1) {
        alert("Somente administradores podem acessar Grupos.");
        window.location.href = "dashboard.html";
        return;
    }

    // esconder vendas se for cliente
    const menuVendas = document.getElementById("menu-vendas");
    if (usuario.grupo_id === 3 && menuVendas) {
        menuVendas.style.display = "none";
    }
}


// ===============================================
// LOGOUT
// ===============================================
function configurarLogout() {
    document.querySelectorAll(".logout").forEach(link => {
        link.addEventListener("click", () => {
            localStorage.removeItem("usuario");
            window.location.href = "index.html";
        });
    });
}


// ===============================================
// INICIALIZAÇÃO
// ===============================================
document.addEventListener("DOMContentLoaded", () => {
    verificarPermissoes();
    carregarGrupos();
    configurarLogout();
});
</script>
</body>
</html>
